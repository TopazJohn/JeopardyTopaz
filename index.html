<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Team Jeopardy Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #000; color: #fff; text-align: center; margin: 0; }
  h1 { color: #fc8b01; margin-top: 20px; }
  #teams { margin: 20px; }
  input.teamName { padding: 5px; font-size: 1rem; margin: 0 10px; width: 120px; text-align: center; }
  #scores { font-size: 1.5rem; margin: 10px 0; }
  table { margin: 0 auto; border-collapse: collapse; width: 90%; max-width: 900px; }
  th, td { border: 2px solid #fc8b01; padding: 10px; cursor: pointer; }
  th { background-color: #333; }
  td.questionCell { background-color: #111; }
  td.answered { background-color: #222; color: #555; cursor: default; }
  td.dailyDouble { border-color: yellow; font-weight: bold; color: yellow; }
  #questionBox { background: #222; margin: 20px auto; padding: 20px; max-width: 600px; min-height: 100px; }
  #timer { font-size: 2rem; margin: 10px; cursor: pointer; color: #fc8b01; }
  #finalJeopardy { margin-top: 20px; }
  button { padding: 10px 20px; font-size: 1rem; margin: 10px; cursor: pointer; background-color: #fc8b01; border: none; border-radius: 4px; }
  button:disabled { background-color: #666; cursor: not-allowed; }
</style>
</head>
<body>

<h1>Team Jeopardy!</h1>

<div id="teams">
  <input class="teamName" id="teamAName" value="Team A" />
  <input class="teamName" id="teamBName" value="Team B" />
</div>

<div id="scores">
  <span id="teamAScore">Team A: 0</span> | 
  <span id="teamBScore">Team B: 0</span>
</div>

<table id="board">
  <thead id="boardHeader"></thead>
  <tbody id="boardBody"></tbody>
</table>

<div id="questionBox">Click a question to start!</div>

<div id="timer" title="Click to Start/Stop Timer">Timer: 30</div>

<button id="finalJeopardyBtn">Final Jeopardy</button>

<div id="finalJeopardy" style="display:none;">
  <h2>Final Jeopardy</h2>
  <div id="finalQuestionText"></div>
  <input type="number" id="teamAWager" placeholder="Team A Wager" min="0" />
  <input type="number" id="teamBWager" placeholder="Team B Wager" min="0" />
  <br/>
  <button id="finalSubmit">Submit Final Jeopardy</button>
</div>

<script>
  let questionsData = null;
  let timerInterval = null;
  let timerSeconds = 30;
  let timerRunning = false;
  let currentQuestionCell = null;
  let currentCategoryIndex = null;
  let currentQuestionIndex = null;

  let teamAScore = 0;
  let teamBScore = 0;

  // Load questions JSON
  async function loadQuestions() {
    const res = await fetch('questions.json');
    questionsData = await res.json();
    buildBoard();
  }

  // Build the Jeopardy board table
  function buildBoard() {
    const boardHeader = document.getElementById('boardHeader');
    const boardBody = document.getElementById('boardBody');
    boardHeader.innerHTML = '';
    boardBody.innerHTML = '';

    // Headers
    const trHead = document.createElement('tr');
    questionsData.categories.forEach(cat => {
      const th = document.createElement('th');
      th.textContent = cat.name;
      trHead.appendChild(th);
    });
    boardHeader.appendChild(trHead);

    // Rows (questions)
    for (let i = 0; i < 3; i++) {
      const tr = document.createElement('tr');
      questionsData.categories.forEach((cat, catIdx) => {
        const td = document.createElement('td');
        td.className = 'questionCell';
        td.textContent = cat.questions[i].points;
        td.dataset.cat = catIdx;
        td.dataset.qIdx = i;
        if (
          questionsData.dailyDouble.category === catIdx && 
          questionsData.dailyDouble.question === i
        ) {
          td.classList.add('dailyDouble');
          td.textContent += ' ðŸ”¥';
        }
        td.addEventListener('click', onQuestionClick);
        tr.appendChild(td);
      });
      boardBody.appendChild(tr);
    }
  }

  function onQuestionClick(e) {
    const td = e.target;
    if (td.classList.contains('answered')) return; // Already answered

    currentCategoryIndex = parseInt(td.dataset.cat);
    currentQuestionIndex = parseInt(td.dataset.qIdx);
    currentQuestionCell = td;

    const questionObj = questionsData.categories[currentCategoryIndex].questions[currentQuestionIndex];
    const qText = questionObj.question + (questionObj.phone ? ` Call: ${questionObj.phone}` : '');

    document.getElementById('questionBox').textContent = qText;
    startTimer();

    // Mark as selected
    td.classList.add('answered');
  }

  // Timer logic
  function startTimer() {
    if (timerRunning) return;
    timerRunning = true;
    timerSeconds = 30;
    updateTimerDisplay();

    timerInterval = setInterval(() => {
      timerSeconds--;
      updateTimerDisplay();
      if (timerSeconds <= 0) {
        clearInterval(timerInterval);
        timerRunning = false;
        alert('Time up!');
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const timerEl = document.getElementById('timer');
    timerEl.textContent = `Timer: ${timerSeconds}`;
    if (timerSeconds <= 5) {
      timerEl.style.color = 'red';
      timerEl.style.fontWeight = 'bold';
    } else {
      timerEl.style.color = '#fc8b01';
      timerEl.style.fontWeight = 'normal';
    }
  }

  // Clicking timer toggles start/stop
  document.getElementById('timer').addEventListener('click', () => {
    if (timerRunning) {
      clearInterval(timerInterval);
      timerRunning = false;
    } else {
      startTimer();
    }
  });

  // Update score helper
  function updateScores() {
    const teamAName = document.getElementById('teamAName').value || 'Team A';
    const teamBName = document.getElementById('teamBName').value || 'Team B';
    document.getElementById('teamAScore').textContent = `${teamAName}: ${teamAScore}`;
    document.getElementById('teamBScore').textContent = `${teamBName}: ${teamBScore}`;
  }

  // Score buttons for current question
  function showScoreButtons() {
    const questionBox = document.getElementById('questionBox');
    const q = questionsData.categories[currentCategoryIndex].questions[currentQuestionIndex];

    const btnCorrectA = document.createElement('button');
    btnCorrectA.textContent = `+${q.points} ${document.getElementById('teamAName').value || 'Team A'}`;
    btnCorrectA.onclick = () => {
      teamAScore += q.points;
      updateScores();
      questionBox.textContent = 'Select next question';
      clearTimer();
    };

    const btnCorrectB = document.createElement('button');
    btnCorrectB.textContent = `+${q.points} ${document.getElementById('teamBName').value || 'Team B'}`;
    btnCorrectB.onclick = () => {
      teamBScore += q.points;
      updateScores();
      questionBox.textContent = 'Select next question';
      clearTimer();
    };

    const btnWrong = document.createElement('button');
    btnWrong.textContent = `No points`;
    btnWrong.onclick = () => {
      questionBox.textContent = 'Select next question';
      clearTimer();
    };

    questionBox.appendChild(document.createElement('br'));
    questionBox.appendChild(btnCorrectA);
    questionBox.appendChild(btnCorrectB);
    questionBox.appendChild(btnWrong);
  }

  function clearTimer() {
    clearInterval(timerInterval);
    timerRunning = false;
    document.getElementById('timer').textContent = 'Timer: 30';
    document.getElementById('timer').style.color = '#fc8b01';
    document.getElementById('timer').style.fontWeight = 'normal';
  }

  // After question selected, show scoring buttons
  document.getElementById('questionBox').addEventListener('DOMNodeInserted', () => {
    if (
      currentCategoryIndex !== null && 
      currentQuestionIndex !== null &&
      document.getElementById('questionBox').textContent !== 'Select next question' &&
      !document.getElementById('questionBox').querySelector('button')
    ) {
      showScoreButtons();
    }
  });

  // Final Jeopardy logic
  const finalJeopardyBtn = document.getElementById('finalJeopardyBtn');
  finalJeopardyBtn.addEventListener('click', () => {
    document.getElementById('finalJeopardy').style.display = 'block';
    finalJeopardyBtn.disabled = true;
    document.getElementById('questionBox').textContent = '';
    clearTimer();

    // Set a sample final question here or customize
    document.getElementById('finalQuestionText').textContent = 'Final Jeopardy: What is your best sales tip?';
  });

  document.getElementById('finalSubmit').addEventListener('click', () => {
    const wagerA = parseInt(document.getElementById('teamAWager').value) || 0;
    const wagerB = parseInt(document.getElementById('teamBWager').value) || 0;

    const teamAAnswer = confirm('Did Team A answer correctly? OK = Yes, Cancel = No');
    const teamBAnswer = confirm('Did Team B answer correctly? OK = Yes, Cancel = No');

    if (teamAAnswer) teamAScore += wagerA; else teamAScore -= wagerA;
    if (teamBAnswer) teamBScore += wagerB; else teamBScore -= wagerB;

    updateScores();

    alert('Final Jeopardy complete!');

    // Reset final jeopardy UI
    document.getElementById('finalJeopardy').style.display = 'none';
    finalJeopardyBtn.disabled = false;
    document.getElementById('teamAWager').value = '';
    document.getElementById('teamBWager').value = '';
    document.getElementById('questionBox').textContent = 'Select next question';

    // Reset board for new game if you want (optional)
  });

  // Team name inputs update score display dynamically
  document.getElementById('teamAName').addEventListener('input', updateScores);
  document.getElementById('teamBName').addEventListener('input', updateScores);

  // Initialize
  loadQuestions();
  updateScores();

</script>

</body>
</html>
